# Memory Bank Monitoring Scripts Directory

## Overview

This directory contains monitoring and control scripts for the Memory Bank Synchronization System. These scripts provide service management, health monitoring, and real-time status tracking for the automated synchronization infrastructure.

## Directory Structure

```
monitoring/
‚îú‚îÄ‚îÄ README.md                    # This documentation file
‚îú‚îÄ‚îÄ sync-dashboard.md            # System-wide status dashboard
‚îú‚îÄ‚îÄ background-monitor.md        # Background monitoring daemon
‚îú‚îÄ‚îÄ monitor-control.md           # Service control interface
‚îú‚îÄ‚îÄ monitor.pid                  # Process ID tracking (generated)
‚îú‚îÄ‚îÄ monitor.log                  # Monitor output log (generated)
‚îî‚îÄ‚îÄ ...
```

## Scripts Overview

### Core Scripts

#### `sync-dashboard.md`
**Purpose:** Comprehensive system status dashboard
**Usage:** `bash docs/scripts/monitoring/sync-dashboard.md`
**Functionality:**
- Shows synchronization status and last sync time
- Displays file status for all memory bank files
- Lists recent activity and logs
- Provides performance metrics and file sizes
- Shows recommendations for system maintenance

**Output Sections:**
- üîÑ SYNC STATUS: Last sync timestamp and metadata
- üìÅ FILE STATUS: Individual file health and sizes
- üìä RECENT ACTIVITY: Log excerpts and activity
- ‚ö° PERFORMANCE METRICS: File sizes and sync frequency
- üí° RECOMMENDATIONS: Actionable maintenance items

#### `monitor-control.md`
**Purpose:** Service control interface for background monitoring
**Usage:** `bash docs/scripts/monitoring/monitor-control.md {start|stop|status|restart}`
**Commands:**
- `start` - Launch background monitoring service
- `stop` - Gracefully stop monitoring service
- `status` - Show current service status and process info
- `restart` - Stop and restart the service

**Features:**
- Prevents multiple instances from running
- PID tracking and management
- Graceful shutdown with cleanup
- Process health monitoring
- Automatic stale PID cleanup

#### `background-monitor.md`
**Purpose:** Background monitoring daemon
**Usage:** Designed for daemon execution via `monitor-control.md`
**Functionality:**
- Monitors workflow_state.md every 5 minutes
- Triggers automatic sync on workflow changes
- Runs validation checks every 30 minutes
- Maintains continuous synchronization
- Cross-platform compatible (macOS/Linux)

**Monitoring Logic:**
1. Check workflow file modification time
2. If changed within last hour, check last sync time
3. If no sync in last 30 minutes, trigger automatic sync
4. Run periodic validation on schedule
5. Sleep and repeat indefinitely

## Generated Files Documentation

### Process Management Files

#### `monitor.pid`
- **Generated by:** `monitor-control.md start`
- **Purpose:** Tracks the process ID of running background monitor
- **Format:** Single line containing numeric PID
- **Location:** `docs/scripts/monitoring/monitor.pid`
- **Cleanup:** Automatically removed on service stop
- **Usage:** Prevents multiple instances, enables status checks

#### `monitor.log`
- **Generated by:** Background monitor daemon
- **Purpose:** Captures all monitor output and debugging information
- **Format:** `TIMESTAMP: MESSAGE` (one per line)
- **Location:** `docs/scripts/monitoring/monitor.log`
- **Rotation:** Manual (grows slowly, recommend monthly cleanup)
- **Contents:**
  - Service startup/shutdown messages
  - File change detections
  - Sync operation results
  - Validation outcomes
  - Error messages and warnings

### Log Files

#### `background-sync.log`
- **Generated by:** `background-monitor.md` during sync operations
- **Purpose:** Records all automated synchronization attempts
- **Format:** Full sync-engine.md output with timestamps
- **Location:** `docs/scripts/logs/background-sync.log`
- **Contents:** Complete sync operation logs, errors, and results

#### `background-validation.log`
- **Generated by:** `background-monitor.md` during validation runs
- **Purpose:** Records automated validation check results
- **Format:** Full sync-validator.md output with timestamps
- **Location:** `docs/scripts/logs/background-validation.log`
- **Contents:** Validation results, integrity checks, error reports

## Setup Instructions

### Initial Setup
```bash
# The monitoring system is set up automatically by:
bash docs/scripts/automation/enhanced-automation.md

# This creates all necessary monitoring scripts and configurations
```

### Starting the Monitoring Service
```bash
# Start background monitoring
bash docs/scripts/monitoring/monitor-control.md start

# Expected output:
# Starting background monitor...
# Monitor started (PID: 12345)
```

### Verification
```bash
# Check service status
bash docs/scripts/monitoring/monitor-control.md status

# View system dashboard
bash docs/scripts/monitoring/sync-dashboard.md
```

## Usage Examples

### Service Management
```bash
# Start monitoring service
bash docs/scripts/monitoring/monitor-control.md start

# Check if running
bash docs/scripts/monitoring/monitor-control.md status

# Stop service
bash docs/scripts/monitoring/monitor-control.md stop

# Restart service
bash docs/scripts/monitoring/monitor-control.md restart
```

### Monitoring Operations
```bash
# View comprehensive system status
bash docs/scripts/monitoring/sync-dashboard.md

# Monitor logs in real-time
tail -f docs/scripts/monitoring/monitor.log

# Check recent sync activity
tail -20 docs/scripts/logs/background-sync.log
```

### Troubleshooting
```bash
# Check service health
bash docs/scripts/monitoring/monitor-control.md status

# View recent monitor activity
tail -10 docs/scripts/monitoring/monitor.log

# Test manual sync
bash docs/scripts/sync-engine.md

# Validate system integrity
bash docs/scripts/validation/sync-validator.md
```

## Dependencies

### Required Tools
- **Bash:** Script execution environment
- **Standard Unix Utilities:** ps, kill, sleep, date, stat
- **jq (optional):** JSON parsing for metadata (fallback available)

### System Requirements
- **Memory:** < 10MB for background monitor
- **CPU:** < 1% during normal operation
- **Disk:** Minimal for logs (recommend monthly cleanup)
- **Permissions:** Write access to monitoring directory

## Error Handling

### Common Issues

#### Monitor Won't Start
```bash
# Check for existing PID file
ls -la docs/scripts/monitoring/monitor.pid

# Clean up stale PID
rm docs/scripts/monitoring/monitor.pid

# Try starting again
bash docs/scripts/monitoring/monitor-control.md start
```

#### Monitor Process Died
```bash
# Check log for errors
tail -20 docs/scripts/monitoring/monitor.log

# Check system resources
ps aux | grep monitor

# Restart service
bash docs/scripts/monitoring/monitor-control.md restart
```

#### High Resource Usage
```bash
# Check monitor process
ps -p $(cat docs/scripts/monitoring/monitor.pid) -o pid,ppid,cmd,%cpu,%mem

# View recent activity
tail -50 docs/scripts/monitoring/monitor.log

# Consider adjusting check intervals in background-monitor.md
```

### Error Recovery
```bash
# Stop problematic service
bash docs/scripts/monitoring/monitor-control.md stop

# Clean up files
rm -f docs/scripts/monitoring/monitor.pid
rm -f docs/scripts/monitoring/monitor.log

# Restart fresh
bash docs/scripts/monitoring/monitor-control.md start
```

## Performance Characteristics

### Resource Usage
- **Memory:** ~8-12MB for background monitor process
- **CPU:** < 1% average, spikes to 5% during sync operations
- **Disk I/O:** Minimal, primarily log writes
- **Network:** Only during sync/validation (external API calls)

### Timing Characteristics
- **Startup Time:** < 2 seconds
- **File Check Cycle:** 5 minutes (300 seconds)
- **Validation Cycle:** 30 minutes (1800 seconds)
- **Sync Operation:** < 5 seconds typical
- **Status Check:** < 1 second

### Scalability
- **Concurrent Operations:** Handles one sync/validation at a time
- **Queue Management:** Automatic cooldown prevents overlapping operations
- **Resource Limits:** Self-limiting to prevent system impact

## Maintenance

### Regular Tasks
```bash
# Daily: Check service status
bash docs/scripts/monitoring/monitor-control.md status

# Weekly: Review system dashboard
bash docs/scripts/monitoring/sync-dashboard.md

# Monthly: Clean up old logs
find docs/scripts/logs -name "background-*.log" -mtime +30 -delete
find docs/scripts/monitoring -name "monitor.log.*" -delete 2>/dev/null || true
```

### Log Management
```bash
# View log sizes
du -sh docs/scripts/monitoring/monitor.log
du -sh docs/scripts/logs/background-*.log

# Archive old logs
tar -czf logs-archive-$(date +%Y%m%d).tar.gz docs/scripts/logs/
find docs/scripts/logs -name "*.log" -mtime +7 -delete
```

### Health Monitoring
```bash
# Check process health
bash docs/scripts/monitoring/monitor-control.md status

# Monitor error rates
grep "ERROR" docs/scripts/monitoring/monitor.log | tail -10

# Check sync success rate
grep "Sync completed successfully" docs/scripts/logs/background-sync.log | wc -l
```

## Integration Points

### With Automation Scripts
- **enhanced-automation.md:** Creates monitoring infrastructure
- **automation-status.md:** Checks monitor status
- **workflow-watcher.md:** Alternative real-time monitoring

### With Core System
- **sync-engine.md:** Called for synchronization
- **sync-validator.md:** Called for validation
- **Git hooks:** Trigger status updates

### With Development Tools
- **VS Code:** Tasks integration for manual sync
- **Git:** Hook integration for automatic sync
- **System monitoring:** Process supervision

## Security Considerations

### Process Security
- Background processes run with user permissions
- No elevated privileges required
- Process isolation prevents system impact

### Data Security
- Log files contain operational data only
- No sensitive information logged
- File permissions follow standard practices

### Network Security
- External API calls use existing authentication
- No new network exposure
- SSL/TLS for all external communications

## Troubleshooting Guide

### Service Won't Start
1. Check disk space: `df -h`
2. Verify script permissions: `ls -la docs/scripts/monitoring/`
3. Check for conflicting processes: `pgrep -f monitor`
4. Review error logs: `tail -20 docs/scripts/monitoring/monitor.log`

### Sync Operations Failing
1. Test manual sync: `bash docs/scripts/sync-engine.md`
2. Check source file: `ls -la docs/cursorkleosr/workflow_state.md`
3. Verify target directory: `ls -la docs/memory-bank/`
4. Review sync logs: `tail -50 docs/scripts/logs/background-sync.log`

### High Resource Usage
1. Check process status: `ps -p $(cat docs/scripts/monitoring/monitor.pid) -o pid,%cpu,%mem,cmd`
2. Review recent activity: `tail -100 docs/scripts/monitoring/monitor.log`
3. Consider adjusting intervals in `background-monitor.md`
4. Check for runaway processes

### Validation Errors
1. Run manual validation: `bash docs/scripts/validation/sync-validator.md`
2. Check validation logs: `tail -50 docs/scripts/logs/background-validation.log`
3. Verify file integrity: `find docs/memory-bank -name "*.md" -exec wc -l {} \;`
4. Check metadata: `cat docs/memory-bank/.sync-metadata.json`

## Future Enhancements

### Planned Features
- Web-based monitoring dashboard
- Alert system for sync failures
- Performance metrics collection
- Advanced scheduling options
- Multi-instance coordination

### Monitoring Improvements
- Real-time metrics via API
- Historical trend analysis
- Automated issue detection
- Performance profiling

---

## Quick Reference

```bash
# Service Control
bash docs/scripts/monitoring/monitor-control.md start     # Start monitoring
bash docs/scripts/monitoring/monitor-control.md status    # Check status
bash docs/scripts/monitoring/monitor-control.md stop      # Stop monitoring
bash docs/scripts/monitoring/monitor-control.md restart   # Restart service

# System Status
bash docs/scripts/monitoring/sync-dashboard.md            # Full system status

# Troubleshooting
tail -f docs/scripts/monitoring/monitor.log               # Monitor logs
tail -f docs/scripts/logs/background-sync.log             # Sync logs
bash docs/scripts/validation/sync-validator.md            # Validate system
```

For detailed diagnostics, run the sync dashboard and check all log files in `docs/scripts/logs/` and `docs/scripts/monitoring/`.